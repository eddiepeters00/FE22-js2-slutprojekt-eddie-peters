{"mappings":"AAWAA,eAAeC,EAAaC,GAExB,OAaJ,SAAsBC,EAAyBD,GAC3C,IAAIE,GAAqB,EAKzB,GAHAC,QAAQC,IAAI,cACZD,QAAQC,IAAI,YAAaH,GACzBE,QAAQC,IAAI,cAAeJ,GACb,OAAVC,EAAgB,CAChB,IAAK,MAAMI,KAAQJ,EACXI,EAAK,QAAaL,EAAQ,OAAYK,EAAK,WAAgBL,EAAQ,WACnEG,QAAQC,IAAI,eACZF,GAAY,GAGhBA,GAEAC,QAAQC,IAAI,4BAEpB,CACA,OAAOF,CACX,CAhCWI,OADaC,IACOP,EAC/B,CAGAF,eAAeS,IACX,MACMC,QAAiBC,MADH,sFAGpB,aADoBD,EAASE,MAEjC,CChBA,MAAMC,EAAqB,CAAC,EAGTC,SAASC,cAAc,iBAC/BC,iBAAiB,UAAUC,IAClCA,EAAEC,iBACFJ,SAASK,iBAAiB,SAASC,SAAQC,IACnB,OAAhBA,EAAMC,OAAkC,KAAhBD,EAAMC,QAC9BT,EAAQQ,EAAME,MAAQF,EAAMC,MAAK,IAU7CtB,eAA4BE,SACKD,EAAaC,IAKtCG,QAAQC,IAAI,cAGZkB,YAAW,KACPnB,QAAQC,IAAI,yBACZ,IACImB,OAAOC,SAASC,OAAO,8BAC3B,CAAE,MAAOV,GACLZ,QAAQC,IAAIW,EAChB,IACD,MAZHZ,QAAQC,IAAI,QAcpB,CAxBIsB,CAAaf,IACN","sources":["src/modules/firebase.ts","src/index.ts"],"sourcesContent":["import { User } from \"./User\";\r\n\r\ntype UserInput = {\r\n    [key: string]: string;\r\n};\r\n\r\ntype UserValidation = {\r\n    email: string,\r\n    password: string\r\n};\r\n\r\nasync function findUserInDb(userObj: UserInput): Promise<boolean> {\r\n    const users = await getAllUsers();\r\n    return validateUser(users, userObj);\r\n}\r\n\r\n//Fetch users from firebase\r\nasync function getAllUsers(): Promise<UserValidation[]> {\r\n    const url: string = 'https://js2-social-media-default-rtdb.europe-west1.firebasedatabase.app/users.json';\r\n    const response = await fetch(url);\r\n    const users = await response.json();\r\n    return users;\r\n}\r\n\r\n//Checks if the new users password and email matches an registered users email and password\r\n//Return true if its a match\r\nfunction validateUser(users: UserValidation[], userObj: UserInput): boolean {\r\n    let userFound: boolean = false;\r\n\r\n    console.log('VALIDATION');\r\n    console.log('ALL USERS', users);\r\n    console.log('USER OBJECT', userObj);\r\n    if (users !== null) {\r\n        for (const user of users) {\r\n            if (user[\"email\"] === userObj[\"email\"] && user[\"password\"] === userObj[\"password\"]) {\r\n                console.log('User found!');\r\n                userFound = true;\r\n            }\r\n        }\r\n        if(!userFound){\r\n            //Display error\r\n            console.log('Could not find user in db');\r\n        } \r\n    }\r\n    return userFound;\r\n}\r\n\r\nasync function addUserToDb(user: User) {\r\n    const users = await getAllUsers();\r\n    let index: number = 0;\r\n    if (users !== null) {\r\n        index = users.length;\r\n    }\r\n\r\n    const url: string = `https://js2-social-media-default-rtdb.europe-west1.firebasedatabase.app/users/${index}.json`;\r\n    const init = {\r\n        method: 'PUT',\r\n        body: JSON.stringify(user),\r\n        headers: {\r\n            \"Content-type\": \"application/json; charset=UTF-8\"\r\n        }\r\n    }\r\n\r\n    const response = await fetch(url, init);\r\n    const data = response.json();\r\n    console.log(data);\r\n}\r\n\r\nexport { findUserInDb, addUserToDb };","import { findUserInDb } from \"./modules/firebase\";\r\n\r\ntype UserInput = {\r\n    [key: string]: string;\r\n}\r\n\r\nconst userObj: UserInput = {};\r\n\r\n//Get userinputs from register-form\r\nconst signInForm = document.querySelector('#sign-in-form') as HTMLFormElement;\r\nsignInForm.addEventListener('submit', e => {\r\n    e.preventDefault();\r\n    document.querySelectorAll('input').forEach(input => {\r\n        if (input.value !== null && input.value !== '') {\r\n            userObj[input.name] = input.value;\r\n        }\r\n    });\r\n\r\n    logInHandler(userObj);\r\n    return false;\r\n});\r\n\r\n\r\n//Check if user exists in db\r\nasync function logInHandler(userObj: UserInput) {\r\n    const found: boolean = await findUserInDb(userObj);\r\n    if (!found) {\r\n        //Prompt message to user\r\n        console.log('Error');        \r\n    } else {\r\n        console.log('Logging in');\r\n        \r\n        //Add animation? \r\n        setTimeout(() => {\r\n            console.log('GOING TO ANOTHER PAGE')\r\n            try {\r\n                window.location.assign(\"src/html/userHomePage.html;\");\r\n            } catch (e) {\r\n                console.log(e);\r\n            }\r\n        }, 1000);\r\n    }\r\n}"],"names":["async","$14f6629ccf7de9b8$export$31fab651fc2b928c","userObj","users","userFound","console","log","user","$14f6629ccf7de9b8$var$validateUser","$14f6629ccf7de9b8$var$getAllUsers","response","fetch","json","$b4e14b6b8da86996$var$userObj","document","querySelector","addEventListener","e","preventDefault","querySelectorAll","forEach","input","value","name","setTimeout","window","location","assign","$b4e14b6b8da86996$var$logInHandler"],"version":3,"file":"index.b08cff5b.js.map"}